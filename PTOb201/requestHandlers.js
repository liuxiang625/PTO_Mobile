/*** @author david robbins*///Lesser Known Features of Wakanda//http request handlersfunction echo(request, response) {	/*	response.contentType = 'application/json';	return JSON.stringify(request);	*/			/**/	response.contentType = 'text/html';		var params = request.rawURL.split("/"),	  	backGroundColor = "6699CC",	  	fontSize = 32;		//#F8B501					if (params.length > 2) { 		backGroundColor = params[2];	}			if (params.length > 3) {		fontSize = params[3];	}		var html = "";	html += '<div style="width:270px; height:190px; position:absolute; left:50%; top:50%; margin:-75px 0 0 -135px; background-color:' + backGroundColor + '; -moz-border-radius:6px; -webkit-border-radius:6px; border-radius:6px;">';	html += '<p style="color:white; text-align:center; position:absolute; font-size: ' + fontSize + '; margin:60px 40px;">';	html += "Wakanday 2012! ";	html += '</p>';	html += '</div>';		return html;	}//HTTP Request Handlerfunction ptoApproval(request, response) {	//if (loginByPassword("approvalDaemon", "June2012")) {	var sessionRef = currentSession(); // Get session.	var promoteToken = sessionRef.promoteWith("Internal"); //temporarily make this session Internal level.	var params = request.rawURL.split("/"),		ptoID = params[2],		approvePassword =params[3],		approveID =params[4],		approvalString = params[5],		ptoToApprove = ds.PTO_Request(ptoID);					response.contentType = 'text/html';		//authenticate this request to approve.	var ha1 = directory.computeHA1(approveID, approvePassword);	if (ha1 === ptoToApprove.approveHA1Key) {		ptoToApprove.status = "approved";		ptoToApprove.save();				//Send email to requestor --- start		var theEmailWorker = new SharedWorker("sharedWorkers/emailDaemon.js", "emailDaemon");		var thePort = theEmailWorker.port; // MessagePort to communicate with the email shared worker.		/**/				var requestLineItemsArray = [];		var lineItems = ptoToApprove.requestLineItemCollection;		lineItems.forEach(function(lineItem) {			var lineItemObj = {};			lineItemObj.hoursRequested = lineItem.hoursRequested;			lineItemObj.dateRequested = formatDate(lineItem.dateRequested);			lineItemObj.compensation = lineItem.compensation;			requestLineItemsArray.push(lineItemObj);		});				thePort.postMessage({what: 'requestApproved',			requestorID : ptoToApprove.requestor.ID,			firstDayOff: formatDate(ptoToApprove.firstDayOff),			lastDayOff: formatDate(ptoToApprove.lastDayOff),			requestLineItems: requestLineItemsArray,			notes: ptoToApprove.emailText,			status: ptoToApprove.status		});				//Send email to requestor --- end		sessionRef.unPromote(promoteToken); //put the session back to normal.				var html = "";		html += '<div style="width:270px; height:150px; position:absolute; left:50%; top:50%; margin:-75px 0 0 -135px; background-color:#6699CC; -moz-border-radius:6px; -webkit-border-radius:6px; border-radius:6px;">';		html += '<p style="color:white; text-align:center; position:absolute; font-size:22px; margin:60px 40px;">';		html += "PTO: " + ptoID + " approved.";		html += '</p>';		html += '</div>';				//return "PTO: " + ptoID + " approved.";		return html;	} else {		sessionRef.unPromote(promoteToken); //put the session back to normal.		return "Could not authenticate your request to approve PTO: " + ptoID + ".";	}			//} //if (loginByPassword("approvalDaemon", "June2012")) {} //function ptoApproval(request, response)